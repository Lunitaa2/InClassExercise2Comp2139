@* specifies that this view expects a Project object *@ 

@model Project  
@{ 

    ViewData["Title"] = "Project Details";  //sets the title of the view to "Project Details" 

} 
 
 

<h2>Project Details</h2> 

 

<div class="card"> 

    <div class="card-body"> 

        <h3 class="card-title">@Model.Name</h3> 

        <p class="card-text">@Model.Description</p> 

         

        <!-- Display other properties of the project as needed --> 

        <!-- dl: definition list --> 

        <dl class="row">
            
            <dt class="col-sm-3">Project ID</dt>
            <dd class="col-sm-9">@Model.ProjectId</dd>
            <!-- Lab 5 Part3 #1 -->
            <dt class="col-sm-3">Start Date</dt>
            <dd class="col-sm-9">@Model.StartDate.ToShortDateString()</dd>

            <dt class="col-sm-3">End Date</dt>
            <dd class="col-sm-9">@Model.EndDate.ToShortDateString()</dd>

            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">@Model.Status</dd>

            <!-- Add more properties here -->

            <!-- Example: 

            <dt class="col-sm-3">Start Date</dt> 

            <dd class="col-sm-9">@Model.StartDate.ToShortDateString()</dd> 

            -->

        </dl> 

 

        <!-- You can also add actions here, like Edit, Delete, etc. -->

        <!-- The asp-route-id tag helper is used to pass the project ID to the Edit action -->

        <a asp-action="Edit" asp-route-id="@Model.ProjectId" class="btn btn-primary">Edit</a>

        <a asp-action="Index" class="btn btn-secondary">Back to List</a>

    </div>

</div>

<!-- Comments Section -->
<div class="card mt-4">
    <div class="card-header">
        <h4>Comments</h4>
    </div>
    <div class="card-body">
        <!-- Add Comment Form -->
        <div class="mb-3">
            <textarea id="commentContent" class="form-control" placeholder="Add a comment..." rows="3" maxlength="500"></textarea>
            <button id="addCommentBtn" class="btn btn-primary mt-2">Add Comment</button>
        </div>

        <!-- Comments List -->
        <div id="commentsList">
            <p class="text-muted">Loading comments...</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const projectId = @Model.ProjectId;

        // Load comments when page loads
        $(document).ready(function() {
            loadComments();
        });

        // Add comment
        $('#addCommentBtn').click(function() {
            const content = $('#commentContent').val().trim();

            if (!content) {
                alert('Please enter a comment');
                return;
            }

            $.ajax({
                url: '/ProjectManagement/ProjectComment/AddComment',
                type: 'POST',
                contentType: 'application/json',
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                data: JSON.stringify({
                    projectId: projectId,
                    content: content
                }),
                success: function(response) {
                    if (response.success) {
                        $('#commentContent').val('');
                        loadComments();
                    } else {
                        alert('Error adding comment: ' + (response.errors ? response.errors.join(', ') : 'Unknown error'));
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                    alert('Failed to add comment');
                }
            });
        });

        // Load comments
        function loadComments() {
            $.ajax({
                url: '/ProjectManagement/ProjectComment/GetComments/' + projectId,
                type: 'GET',
                success: function(comments) {
                    displayComments(comments);
                },
                error: function(xhr, status, error) {
                    console.error('Error loading comments:', error);
                    $('#commentsList').html('<p class="text-danger">Failed to load comments</p>');
                }
            });
        }

        // Display comments
        function displayComments(comments) {
            if (comments.length === 0) {
                $('#commentsList').html('<p class="text-muted">No comments yet. Be the first to comment!</p>');
                return;
            }

            let html = '';
            comments.forEach(function(comment) {
                const date = new Date(comment.datePosted);
                html += `
                    <div class="comment mb-3 p-3 border rounded">
                        <p class="mb-1">${escapeHtml(comment.content)}</p>
                        <small class="text-muted">${date.toLocaleString()}</small>
                        <button class="btn btn-sm btn-danger float-end" onclick="deleteComment(${comment.projectCommentId})">Delete</button>
                    </div>
                `;
            });
            $('#commentsList').html(html);
        }

        // Delete comment
        function deleteComment(commentId) {
            if (!confirm('Are you sure you want to delete this comment?')) {
                return;
            }

            $.ajax({
                url: '/ProjectManagement/ProjectComment/DeleteComment/' + commentId,
                type: 'DELETE',
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                success: function(response) {
                    if (response.success) {
                        loadComments();
                    } else {
                        alert('Error deleting comment: ' + (response.message || 'Unknown error'));
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                    alert('Failed to delete comment');
                }
            });
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
}